---
title: レートリミッターの仕組み
createdDate: 2025-01-09T09:36:16.348Z
description: レートリミッターの仕組みを解説いたします。
tags:
  - Go
iconUrl: https://raw.githubusercontent.com/microsoft/fluentui-emoji/main/assets/Fox/Flat/fox_flat.svg
---

## 　レートリミッターとは

クライアントやサービスから送信されるトラフィックの速度を制御する仕組み。
例えば、APIレートリミッターを使用すると、APIリクエスト数が指定した閾値を超えると、すべてのコールがブロックされる。

## レートリミッターの目的

* DoS攻撃によるリソースの枯渇を防ぐ
* コストの削減
* サーバの過負荷を防ぐ

## レートリミッターのレイヤ

レートリミッタはクライアントサイドとサーバサイド両方に設置することができます。

### クライアントサイドでの実装

クライアントサイドに設置すると、リクエストを偽造される可能性がある。

以下は`lodash` を使用してAPIリクエストをスロットリングする例です。

```js
import _ from 'lodash';

const sendRequest = () => {
    console.log("APIリクエストを送信");
};

//  1秒ごとに1回のみ許可リクエストを許可
const throttledSendRequest = _.throttle(sendRequest, 1000);
```

### サーバサイドでの実装

![サーバサイドの設定例](../../public/static/assets/img/posts/rate-limitter/img.png)

サーバサイド側で実装した場合、アルゴリズムは完全に制御でき、技術スタックなども有効なものを使用することができるが、レートリミッターを独自に構築することはコストがかかります。

### ミドルウェアで実装

![ミドルウェアのレートリミッター](../../public/static/assets/img/posts/rate-limitter/img-1.png)

ミドルウェアでレートリミッターを実装すると、リクエストをスロットリングし、ステータスコード429のレスポンスを返します。
429のステータスコードはユーザが多すぎるリクエストを送信したことを表します。

クラウドマイクロサービスなどでは、APIゲートウェイというレート制限、SSL終了、認証、IPホワイトリスト、静的コンテンツのサービなどをサポートするフルマネージドサービスがあります。サーバサイドにレートリミッターを設置するのに対して、APIゲートウェイはマイクロサービスと相性がよく、導入も容易いです。

## レートリミッターのアルゴリズム

* トークンバケット(Token Bucket)
* リーキーバケット(Leaky Bucket)
* 固定ウィンドウカウンタ(Fixed Window Counters)
* スライディングウィンドウログ(Sliding Window Log)
* スライディングウィンドウカウンタ(Sliding Window Counter)

## Goで実装する
